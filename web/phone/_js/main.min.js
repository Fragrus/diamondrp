let ifShown = !0;
var phoneCode = 0;
var bankPrefix = 0;
$(document).ready(function() {
    showContent('main-555');
    hidePhone()
});

function eventSend(data) {
    try {
        if (data.type == 'showPhone') {
            if (phoneCode === 0) return !1;
            showPhone();
            showContent('main-' + phoneCode)
        }
        if (data.type == 'hidePhone') {
            showContent('main-' + phoneCode);
            hidePhone()
        } else if (data.type == 'updateValues') {
            $('#day-name').html(data.dayname);
            $('#date').html(data.date);
            $('#time').html(data.time);
            $('#main-time').html(data.time);
            $('#temp-lvl').html(data.temp);
            phoneCode = data.code;
            bankPrefix = data.bprefix;
            $('.network-large').addClass('hide');
            $('.network-medium').addClass('hide');
            $('.network-small').addClass('hide');
            $('.network-none').addClass('hide');
            if (data.network > 1)
                $('.network-small').removeClass('hide');
            if (data.network > 33)
                $('.network-medium').removeClass('hide');
            if (data.network > 66)
                $('.network-large').removeClass('hide');
            else $('.network-none').removeClass('hide');
            $('.phone-container').removeClass('phone-555');
            $('.phone-container').removeClass('phone-777');
            $('.phone-container').removeClass('phone-111');
            $('.phone-container').removeClass('phone-404');
            $('.phone-container').removeClass('phone-403');
            $('.phone-container').addClass('phone-' + phoneCode)
        } else if (data.type == 'showBankMenu') {
            $('.data-bank-money').html(data.money);
            $('.data-bank-number').html(data.number);
            if (bankPrefix == 2222)
                showContent('fleeca');
            else if (bankPrefix == 3333)
                showContent('blaine');
            else if (bankPrefix == 4444)
                showContent('pacific');
            else showContent('maze')
        } else if (data.type == 'addSmsList') {
            $('#data-sms-list').html(data.list);
            showContent('sms')
        } else if (data.type == 'addContList') {
            $('#data-cont-list').html(data.list);
            showContent('cont')
        } else if (data.type == 'addConsoleMessageEvent') {
            addConsoleMessageEvent(data.msg)
        } else if (data.type == 'showSmsItem') {
            $('#data-sms-item').html(data.item);
            showContent('sms-action')
        } else if (data.type == 'showContItem') {
            $('#data-cont-item').html(data.item);
            showContent('cont-action')
        }
    } catch (e) {
        mp.trigger("client:phone:debug", 'DebugPhone: ' + e + ' data: ' + jsonData)
    }
};

function enterEvent() {
    $active = $('.active');
    var action = $active.attr('act');
    var param1 = $active.attr('param1');
    var param2 = $active.attr('param2');
    if (action == 'smsList') {
        mp.trigger('client:phone:showSmsList')
    } else if (action == 'enableRadio') {
        hidePhone();
        mp.trigger('client:phone:enableRadio')
    } else if (action == 'disableRadio') {
        hidePhone();
        mp.trigger('client:phone:disableRadio')
    } else if (action == 'contList') {
        mp.trigger('client:phone:showContList')
    } else if (action == 'smsinfo') {
        mp.trigger('client:phone:smsInfo', parseInt(param1))
    } else if (action == 'continfo') {
        mp.trigger('client:phone:contInfo', parseInt(param1))
    } else if (action == 'newsms') {
        hidePhone();
        mp.trigger('client:phone:newSms')
    } else if (action == 'newcont') {
        hidePhone();
        mp.trigger('client:phone:newCont')
    } else if (action == 'newsmswithnum') {
        hidePhone();
        mp.trigger('client:phone:newSmsWithNum', param1)
    } else if (action == 'callwithnum') {
        hidePhone();
        mp.trigger('client:phone:callwithnum', param1)
    } else if (action == 'sms-del') {
        mp.trigger('client:phone:delSms', parseInt(param1))
    } else if (action == 'cont-del') {
        mp.trigger('client:phone:delCont', parseInt(param1))
    } else if (action == 'cont-ren') {
        mp.trigger('client:phone:renCont', parseInt(param1))
    } else if (action == 'mazeMenu') {
        if (bankPrefix == 1111) {
            mp.trigger('client:phone:bankMenu')
        } else {
            showContent('maze-none');
            return !1
        }
    } else if (action == 'fleecaMenu') {
        if (bankPrefix == 2222) {
            mp.trigger('client:phone:bankMenu')
        } else {
            showContent('fleeca-none');
            return !1
        }
    } else if (action == 'blaineMenu') {
        if (bankPrefix == 3333) {
            mp.trigger('client:phone:bankMenu')
        } else {
            showContent('blaine-none');
            return !1
        }
    } else if (action == 'pacificMenu') {
        if (bankPrefix == 4444) {
            mp.trigger('client:phone:bankMenu')
        } else {
            showContent('pacific-none');
            return !1
        }
    } else if (action == '911-1') {
        hidePhone();
        mp.trigger('client:phone:9111')
    } else if (action == '911-2') {
        hidePhone();
        mp.trigger('client:phone:9112')
    } else if (action == '911-3') {
        hidePhone();
        mp.trigger('client:phone:9113')
    } else if (action == 'misterk1') {
        hidePhone();
        mp.trigger('client:phone:misterk1')
    } else if (action == 'misterk2') {
        hidePhone();
        mp.trigger('client:phone:misterk2')
    } else if (action == 'gettaxi') {
        hidePhone();
        mp.trigger('client:phone:getTaxi', parseInt(param1))
    } else if (action == 'gettaxi2') {
        hidePhone();
        mp.trigger('client:phone:getTaxi2', parseInt(param1))
    } else if (action == 'loto') {
        hidePhone();
        mp.trigger('client:phone:invaderLoto')
    } else if (action == 'ad1') {
        hidePhone();
        mp.trigger('client:phone:invaderAd', 0)
    } else if (action == 'ad2') {
        hidePhone();
        mp.trigger('client:phone:invaderAd', 1)
    } else if (action == 'ad3') {
        hidePhone();
        mp.trigger('client:phone:invaderAd', 2)
    } else if (action == 'setwaypoint') {
        hidePhone();
        mp.trigger('client:phone:setWaypoint', parseInt(param1), parseInt(param2))
    } else if (action == 'transferBank') {
        hidePhone();
        mp.trigger('client:phone:transferBank')
    } else if (action == 'payTaxByNumber') {
        hidePhone();
        mp.trigger('client:phone:payTaxByNumber')
    }
    if (action == 'console')
        showContent('console');
    else if (action == 'browser') {
        hidePhone();
        mp.trigger('client:phone:showBrowser')
    } else if (action == 'tomain')
        showContent('main-' + phoneCode);
    else if (action == 'invaderMenu')
        showContent('lifeinvader');
    else if (action == 'sms-read') {
        mp.trigger('client:phone:readSms', $('#data-sms-text').html())
    } else if (action == 'arcadiusMenu') {
        mp.trigger('client:phone:arcadiusMenu')
    } else if (action == 'taxiMenu') {
        showContent('taxi')
    } else if (action == 'radioMenu') {
        showContent('radio')
    } else if (action == 'cancelCall') {
        mp.trigger('client:phone:cancelCall')
    } else if (action == 'taxi2Menu') {
        showContent('taxi2')
    } else showPreloader()
}

function hidePhone() {
    if (ifShown) {
        $('.animated').removeClass('fadeIn');
        $('.animated').addClass('fadeOut');
        showContent('main-' + phoneCode);
        ifShown = !1
        mp.trigger('phone:hide')
    }
}

function showPhone() {
    $('body').removeClass('hide');
    if (!ifShown) {
        $('.animated').removeClass('fadeOut');
        $('.animated').addClass('fadeIn');
        ifShown = !0
    }
}

function showPreloader() {
    showContent('preloader')
}

function showContent(content) {
    $('#phone-page').html($('#tpl-' + content).html());
    findFocus()
}

function colUp() {
    for (var i = 0; i < 3; i++) {
        var $itemPrev = $('.active').prev();
        if ($itemPrev.length === 0)
            $('.clickpanel').find('li').last().focus();
        else $itemPrev.focus()
    }
}

function colLeft() {
    var $itemPrev = $('.active').prev();
    if ($itemPrev.length === 0)
        $('.clickpanel .cols').find('li').last().focus();
    else $itemPrev.focus()
}

function colDown() {
    for (var i = 0; i < 3; i++) {
        var $itemPrev = $('.active').next();
        if ($itemPrev.length === 0)
            $('.clickpanel').find('li').first().focus();
        else $itemPrev.focus()
    }
}

function colRight() {
    var $itemFirst = $('.active').next();
    if ($itemFirst.length === 0)
        $('.clickpanel .cols').find('li').first().focus();
    else $itemFirst.focus()
}

function listUp() {
    var $itemPrev = $('.active').prev();
    if ($itemPrev.length === 0)
        $('.clickpanel').find('li').last().focus();
    else $itemPrev.focus()
}

function listDown() {
    var $itemPrev = $('.active').next();
    if ($itemPrev.length === 0)
        $('.clickpanel').find('li').first().focus();
    else $itemPrev.focus()
}

function findFocus() {
    $('.clickpanel .cols').on('focus', 'li', function() {
        $this = $(this);
        $this.addClass('active').siblings().removeClass('active');
        $this.closest('.clickpanel .cols').scrollTop($this.index() * $this.outerHeight())
    }).on('keydown', 'li', function(e) {
        if (ifShown) {
            if (e.keyCode == 27 || e.keyCode == 8) {
                hidePhone()
            } else if (e.keyCode == 13) {
                enterEvent();
                return !1
            } else if (e.keyCode == 40) {
                colDown();
                return !1
            } else if (e.keyCode == 39) {
                colRight();
                return !1
            } else if (e.keyCode == 38) {
                colUp();
                return !1
            } else if (e.keyCode == 37) {
                colLeft();
                return !1
            }
        }
    }).find('li').first().focus();
    $('.clickpanel .list').on('focus', 'li', function() {
        $this = $(this);
        $this.addClass('active').siblings().removeClass('active');
        $this.closest('.clickpanel .list').scrollTop($this.position().top - $('.clickpanel .list li').position().top)
    }).on('keydown', 'li', function(e) {
        if (ifShown) {
            if (e.keyCode == 27 || e.keyCode == 8) {
                hidePhone()
            } else if (e.keyCode == 13) {
                enterEvent();
                return !1
            } else if (e.keyCode == 40) {
                listDown();
                return !1
            } else if (e.keyCode == 38) {
                listUp();
                return !1
            }
        }
    }).find('li').first().focus();
    $('#console-input').focus()
}

function addConsoleMessage(msg) {
    $('#console-input').focus();
    $('#console-input').val('');
    $("#data-console").html($("#data-console").html() + '<div>root@srv: ' + msg + '</div>');
    if (msg === 'clear')
        clearConsoleMessage();
    else {
        mp.trigger('client:phone:addConsoleMessage', msg)
    }
    $("#data-console").animate({
        scrollTop: $("#data-console").height()
    }, 0)
}

function addConsoleMessageEvent(msg) {
    $('#console-input').focus();
    $('#console-input').val('');
    $("#data-console").html($("#data-console").html() + '<div>root@srv: ' + msg + '</div>');
    $("#data-console").animate({
        scrollTop: $("#data-console").height()
    }, 0)
}

function clearConsoleMessage() {
    $("#data-console").html('')
    $("#data-console").animate({
        scrollTop: $("#data-console").height()
    }, 0)
}
$(document).on("keydown", function(e) {
    if (ifShown) {
        if (e.keyCode == 27) {
            hidePhone();
            return !1
        } else if (e.keyCode == 13) {
            addConsoleMessage($('#console-input').val());
            return !1
        } else {}
    }
})